/**
* FUNCION SII.F_CREAR_MATRIMONIO
* GENERA UN NUEVO MATRIMONIO A PARTIR DE LOS DATOS DE UN TRAMITE.
* @param IN_CRSEG_CODIGO CODIGO DEL SEGUIMIENTO QUE LLAMA A LA FUNCION
* @param IN_USER_NAME USUARIO DEL SERVIDOR DE APLICACIONES
* @return MENSAJE INFORMATIVO
*/
CREATE OR REPLACE FUNCTION SII.F_CREAR_MATRIMONIO(
IN IN_CRSEG_CODIGO SII.CGG_RES_SEGUIMIENTO.CRSEG_CODIGO%TYPE, 
IN IN_USER_NAME VARCHAR
)RETURNS VARCHAR AS
$$
DECLARE
TMP_RESULT INT;
TMP_CRTRA_CODIGO VARCHAR;
TMP_MSG VARCHAR;
BEGIN
	SELECT 
		TRM.CRTRA_CODIGO
	INTO TMP_CRTRA_CODIGO
	FROM SII.CGG_RES_SEGUIMIENTO SGM 
	INNER JOIN SII.CGG_RES_TRAMITE TRM ON TRM.CRTRA_CODIGO = SGM.CRTRA_CODIGO
	WHERE CRSEG_CODIGO = IN_CRSEG_CODIGO;
	
	
	--REGISTRO DE UN NUEVO MATRIMONIO
	
	TMP_MSG := SII.F_CGG_RES_MATRIMONIO_INSERT(
		'KEYGEN',
		TMP_CRTRA_CODIGO,
		NULL,
		NULL,
		0::SMALLINT,--ESTADO POR DEFECTO EN SEGUIMIENTO
		TRUE,
		IN_USER_NAME
	);
	TMP_MSG :='Matrimonio generado exitosamente..';
	
	RETURN TMP_MSG;
END
$$
LANGUAGE 'plpgsql' VOLATILE CALLED ON NULL INPUT;