<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RptPlantilla" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="d364637a-f053-46a6-9a61-b7c85e0ac9fb">
	<property name="ireport.zoom" value="1.2100000000000002"/>
	<property name="ireport.x" value="5"/>
	<property name="ireport.y" value="68"/>
	<property name="ireport.jasperserver.reportUnit" value="/Reports/sii/tct/rptListadodeTuristasTranseuntesNacionalesExtranjeros"/>
	<property name="ireport.jasperserver.url" value="http://190.95.187.82:8081/jasperserver/services/repository"/>
	<parameter name="P_FECHA_INICIAL" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="P_FECHA_FINAL" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="P_CARPT_CODIGO" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="P_CRMOV_NUMERO_VUELO" class="java.lang.String">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="P_CRALN_CODIGO" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT CASE WHEN MOV.CRMOV_TIPO_OPERACION = 0 THEN 'Ingreso' ELSE 'Salida' END AS ENTSAL,
     SII.F_TRAMITE_TIPO(RSD.CRTST_CODIGO) AS TIPO_PERSONA,
    CASE WHEN MOV.CRMOV_TIPO_OPERACION = 0 THEN ARPI.CARPT_NOMBRE ELSE ARPS.CARPT_NOMBRE END AS AEROPUERTO,
	ARL.CRALN_NOMBRE AS AEROLINEA,
	MOV.CRMOV_NUMERO_VUELO AS VUELO,
   COUNT (RSD.CRTST_CODIGO) AS TOTAL
	FROM SII.CGG_RES_MOVILIDAD MOV
INNER JOIN SII.CGG_RES_AEROLINEA ARL ON ARL.CRALN_CODIGO = MOV.CRALN_CODIGO
INNER JOIN SII.CGG_RES_RESIDENCIA RSD ON RSD.CRRSD_CODIGO = MOV.CRRSD_CODIGO
LEFT JOIN SII.CGG_RES_AEROPUERTO ARPI ON ARPI.CARPT_CODIGO = MOV.CGG_CARPT_CODIGO
LEFT JOIN SII.CGG_RES_AEROPUERTO ARPS ON ARPS.CARPT_CODIGO = MOV.CARPT_CODIGO
WHERE ( (MOV.CGG_CARPT_CODIGO IS NULL AND MOV.CRMOV_TIPO_OPERACION = 1 OR  MOV.CGG_CARPT_CODIGO IS NOT NULL AND MOV.CRMOV_TIPO_OPERACION = 0) OR
	(MOV.CTREG_CODIGO IS NULL AND MOV.CRMOV_TIPO_OPERACION = 0 AND MOV.CGG_CARPT_CODIGO IS NOT NULL OR
	MOV.CTREG_CODIGO IS NULL AND MOV.CRMOV_TIPO_OPERACION = 1 AND MOV.CARPT_CODIGO IS NOT NULL) ) AND
	MOV.CRMOV_FECHA_VIAJE::DATE BETWEEN $P{P_FECHA_INICIAL}::DATE AND $P{P_FECHA_FINAL}::DATE AND
	(MOV.CRMOV_TIPO_OPERACION IS NOT NULL)
AND (LENGTH($P{P_CARPT_CODIGO}) = 0 OR ARPI.CARPT_CODIGO = $P{P_CARPT_CODIGO} OR ARPS.CARPT_CODIGO = $P{P_CARPT_CODIGO})
AND (LENGTH($P{P_CRMOV_NUMERO_VUELO}) = 0 OR MOV.CRMOV_NUMERO_VUELO = $P{P_CRMOV_NUMERO_VUELO} )
AND (LENGTH($P{P_CRALN_CODIGO}) = 0 OR MOV.CRALN_CODIGO = $P{P_CRALN_CODIGO})
AND MOV.CRMOV_SOPORTE=FALSE
GROUP BY MOV.CRMOV_TIPO_OPERACION,RSD.CRTST_CODIGO,AEROPUERTO ,AEROLINEA,VUELO
ORDER BY MOV.CRMOV_TIPO_OPERACION,RSD.CRTST_CODIGO, AEROPUERTO, AEROLINEA, VUELO]]>
	</queryString>
	<field name="crper_codigo" class="java.lang.String"/>
	<field name="nombres" class="java.lang.String"/>
	<field name="total" class="java.lang.Number"/>
	<field name="crper_num_doc_identific" class="java.lang.String"/>
	<field name="nacionalidad" class="java.lang.String"/>
	<field name="tipo" class="java.lang.String"/>
	<field name="tipo_persona" class="java.lang.String"/>
	<field name="entsal" class="java.lang.String"/>
	<field name="aeropuerto" class="java.lang.String"/>
	<field name="aeropuerto_salida" class="java.lang.String"/>
	<field name="crmov_fecha_viaje" class="java.sql.Timestamp"/>
	<field name="aerolinea" class="java.lang.String"/>
	<field name="vuelo" class="java.lang.String"/>
	<field name="usuario" class="java.lang.String"/>
	<field name="actividades" class="java.lang.String"/>
	<field name="hospedajes" class="java.lang.String"/>
	<field name="crmov_soporte" class="java.lang.Boolean"/>
	<field name="crper_usuario" class="java.lang.String"/>
	<field name="cusu_nombre_usuario" class="java.lang.String"/>
	<variable name="V_FECHA_ACTUAL" class="java.util.Date">
		<variableExpression><![CDATA[new Date()]]></variableExpression>
	</variable>
	<variable name="vTotal" class="java.lang.Integer" resetType="Group" resetGroup="TipoResidencia" calculation="Sum">
		<variableExpression><![CDATA[$F{total}]]></variableExpression>
	</variable>
	<variable name="V_FILA" class="java.math.BigDecimal" resetType="Group" resetGroup="grpAeropuerto" incrementType="Report" calculation="Sum">
		<variableExpression><![CDATA[new BigDecimal($V{V_FILA}.intValue()+1)]]></variableExpression>
		<initialValueExpression><![CDATA[new BigDecimal(0)]]></initialValueExpression>
	</variable>
	<group name="USUARIO" isStartNewPage="true">
		<groupExpression><![CDATA[$F{crper_usuario}]]></groupExpression>
		<groupHeader>
			<band height="13"/>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<group name="grpMovimiento">
		<groupExpression><![CDATA[$F{entsal}]]></groupExpression>
		<groupHeader>
			<band height="35">
				<line>
					<reportElement x="181" y="26" width="420" height="1" uuid="cd9f3576-eafa-45fa-9d55-4156cc5b12f7"/>
				</line>
				<textField>
					<reportElement x="-1" y="0" width="763" height="22" uuid="cdaba89c-6cef-4b36-bac1-3aa1016f7f13"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="14" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{entsal}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<group name="TipoResidencia">
		<groupExpression><![CDATA[$F{tipo_persona}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField evaluationTime="Group" evaluationGroup="TipoResidencia">
					<reportElement x="184" y="1" width="526" height="19" uuid="0b8705b4-4c59-4352-a41a-7d614ddcca03"/>
					<textElement textAlignment="Justified" verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{tipo_persona}+" ("+$V{vTotal}.toString()+")"]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<group name="Categoria">
		<groupExpression><![CDATA[$F{tipo}]]></groupExpression>
		<groupHeader>
			<band/>
		</groupHeader>
	</group>
	<group name="grpAeropuerto">
		<groupExpression><![CDATA[$F{aeropuerto}]]></groupExpression>
		<groupHeader>
			<band height="19">
				<staticText>
					<reportElement x="181" y="4" width="20" height="14" uuid="ae22ae4b-0cf7-4a76-bbab-000b91ce0a6e"/>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Nº:]]></text>
				</staticText>
				<staticText>
					<reportElement x="421" y="4" width="89" height="14" uuid="e4df02e6-360f-4ef0-b3c6-6878f961ba7d"/>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Vuelo]]></text>
				</staticText>
				<staticText>
					<reportElement x="321" y="4" width="100" height="14" uuid="78b36c25-78e8-48d5-b47c-1f76de376140"/>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Aerolínea]]></text>
				</staticText>
				<staticText>
					<reportElement x="201" y="4" width="119" height="14" uuid="83aaacb4-7e10-44b1-8bbe-38460a7d60f8"/>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[Aeropuerto]]></text>
				</staticText>
				<staticText>
					<reportElement x="510" y="4" width="91" height="14" uuid="54c0ac4c-7c38-40b7-959e-643da91778dd"/>
					<box>
						<pen lineWidth="0.5"/>
						<topPen lineWidth="0.5"/>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="8" isBold="true"/>
					</textElement>
					<text><![CDATA[TOTAL]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<title>
		<band height="49" splitType="Stretch">
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement positionType="Float" x="633" y="30" width="65" height="14" uuid="df34cde4-b6d3-4c99-9fe7-2bfb106f28d3"/>
				<box leftPadding="0"/>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyyMMdd").parse($P{P_FECHA_INICIAL})]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
				<reportElement positionType="Float" x="737" y="30" width="65" height="14" uuid="849b6e84-d6a9-4891-a2cf-4a60cbfed28d"/>
				<box leftPadding="0"/>
				<textElement verticalAlignment="Middle">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyyMMdd").parse($P{P_FECHA_FINAL})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="583" y="30" width="50" height="14" uuid="ebfd396f-7ae1-4d14-9f1d-bc82f6eee08d"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Desde:]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="698" y="30" width="39" height="14" uuid="d5068672-7419-41b0-be31-8459211b07ad"/>
				<textElement verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[hasta:]]></text>
			</staticText>
			<subreport>
				<reportElement x="0" y="0" width="802" height="28" uuid="3fec2cd0-41cb-43ce-a043-f716653e41a0"/>
				<subreportParameter name="SUBREPORT_DIR"/>
				<subreportParameter name="P_SUBTITULO_2">
					<subreportParameterExpression><![CDATA[""]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="P_SUBTITULO_1">
					<subreportParameterExpression><![CDATA["Listado del Total de Personas que han entrado y salido."]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["repo:/Resources/sii/rptEncabezadoHor"]]></subreportExpression>
			</subreport>
		</band>
	</title>
	<detail>
		<band height="22" splitType="Stretch">
			<textField>
				<reportElement stretchType="RelativeToBandHeight" x="181" y="0" width="20" height="14" uuid="f2b1625b-8173-4cb7-8495-7e6892b5c0f9"/>
				<box>
					<bottomPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[($F{crmov_soporte}?"(*)":"")+$V{V_FILA}.toString()]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="421" y="0" width="90" height="14" uuid="618f7f1e-d0f0-44e7-bfdc-1c8ba9210d24"/>
				<box>
					<bottomPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{vuelo}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement stretchType="RelativeToBandHeight" x="320" y="0" width="100" height="14" uuid="b8d59efb-4b16-4b18-8268-ad7d3c803e6a"/>
				<box>
					<bottomPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{aerolinea}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="201" y="0" width="119" height="14" uuid="ac79def0-49b7-47b9-a9d1-5cd7680ed49c"/>
				<box>
					<bottomPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{aeropuerto}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="510" y="0" width="91" height="14" uuid="85e3bd38-063d-48c0-8010-211b615e7705"/>
				<box>
					<bottomPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="45" splitType="Stretch">
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement x="3" y="10" width="120" height="15" uuid="5d888bcb-a6f1-4043-b7d4-256960585e6f"/>
				<textElement verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{V_FECHA_ACTUAL}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="1" width="802" height="1" uuid="73645b33-f562-4a15-bb45-d327def10bba"/>
			</line>
			<textField>
				<reportElement x="682" y="9" width="80" height="15" uuid="daebae01-53e9-4dd6-b5d3-a2bd45fabd9d"/>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["Pag. "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="762" y="9" width="40" height="15" uuid="8359931c-a738-4d54-82ea-b9d7d6583af6"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<subreport>
				<reportElement x="0" y="25" width="802" height="13" uuid="3ac477c4-be72-4f32-ae11-8c6f1447111f"/>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["repo:/Resources/sii/rptPieHor"]]></subreportExpression>
			</subreport>
		</band>
	</pageFooter>
</jasperReport>
