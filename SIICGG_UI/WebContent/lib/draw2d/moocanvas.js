var MooCanvas=new Class({initialize:function(C,B){var A;if($type(C)=="string"){B=$merge({width:300,height:150},B,{id:C});A=new Element("canvas",B);if(!A.getContext){if(!CanvasRenderingContext2D.cssFixed){document.createStyleSheet().cssText="canvas{display:inline-block;overflow:hidden;text-align:left;cursor:default;}v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}";CanvasRenderingContext2D.cssFixed=true}A.set({styles:{width:B.width,height:B.height,display:"inline-block",overflow:"hidden"},getContext:function(){this.context=this.context||new CanvasRenderingContext2D(A);return this.context}})}}return A}});var CanvasRenderingContext2D=new Class({initialize:function(A){this.parent=A;this.fragment=document.createDocumentFragment();this.element=new Element("div",{styles:{width:A.clientWidth||A.width,height:A.clientHeight||A.height,overflow:"hidden",position:"absolute"}});this.fragment.appendChild(this.element);this.m=[[1,0,0],[0,1,0],[0,0,1]];this.rot=0;this.state=[];this.path=[];this.delay=30;this.max=10;this.i=0;this.Z=10;this.Z2=this.Z/2;this.arcScaleX=1;this.arcScaleY=1;this.currentX=0;this.currentY=0;this.miterLimit=this.Z*1},lineWidth:1,strokeStyle:"#000",fillStyle:"#fff",globalAlpha:1,globalCompositeOperation:"source-over",lineCap:"butt",lineJoin:"miter",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0});CanvasRenderingContext2D.implement({beginPath:function(){this.path=[];this.moved=false},moveTo:function(A,B){this.path.push("m",this.coord(A,B));this.currentX=A;this.currentY=B;this.moved=true},closePath:function(){this.path.push("x")},lineTo:function(A,B){this.path.push((this.moved?"l":","),this.coord(A,B));this.currentX=A;this.currentY=B;this.moved=false},quadraticCurveTo:function(D,C,B,F){var A=2*D,E=2*C;this.bezierCurveTo((A+this.currentX)/3,(E+this.currentY)/3,(A+B)/3,(E+F)/3,B,F)},bezierCurveTo:function(B,F,D,C,A,E){this.path.push(" c ",this.coord(B,F),",",this.coord(D,C),",",this.coord(A,E));this.currentX=A;this.currentY=E},arcTo:function(A,D,B,C){},arc:function(J,H,G,D,B,E){if(this.rot===0){G*=this.Z}var C=Math.cos(D)*G,K=Math.sin(D)*G,A=Math.cos(B)*G,I=Math.sin(B)*G;if(this.rot!==0){var L=Math.PI/24;this.lineTo(C+J,K+H);if(E){if(D<B){D+=2*Math.PI}while(D-L>B){this.lineTo(J+Math.cos(D-=L)*G,H+Math.sin(D)*G)}}else{if(B<D){B+=2*Math.PI}while(D+L<B){this.lineTo(J+Math.cos(D+=L)*G,H+Math.sin(D)*G)}}this.lineTo(A+J,I+H);return }if(C==A&&!E){C+=0.125}var F=this.getCoords(J,H);this.path.push(E?"at ":"wa ",Math.round(F.x-this.arcScaleX*G)+","+Math.round(F.y-this.arcScaleY*G)," ",Math.round(F.x+this.arcScaleX*G)+","+Math.round(F.y+this.arcScaleY*G)," ",this.coord(C+J-this.Z2,K+H-this.Z2)," ",this.coord(A+J-this.Z2,I+H-this.Z2))},rect:function(A,D,B,C){this.moveTo(A,D);this.lineTo(A+B,D);this.lineTo(A+B,D+C);this.lineTo(A,D+C);this.closePath()},fill:function(){this.stroke(true)},stroke:function(C){if(!this.path.length){return }var A,B;if(C){A=[1000,"<v:fill "+this.processColorObject(this.fillStyle)+"></v:fill>"]}else{B=this.processColor(this.strokeStyle);A=[10,'<v:stroke endcap="'+((this.lineCap=="butt")?"flat":this.lineCap)+'" joinstyle="'+this.lineJoin+'" color="'+B.color+'" opacity="'+B.opacity+'"/>']}this.element.insertAdjacentHTML("beforeEnd",'<v:shape path="'+this.path.join("")+'e" stroked="'+!C+'" '+(!C?('strokeweight="'+0.8*this.lineWidth*this.m[0][0]+'" '):"")+'filled="'+!!C+'" coordsize="'+this.Z*A[0]+","+this.Z*A[0]+'" style="width:'+A[0]+"px; height:"+A[0]+'px; position: absolute;">'+A[1]+"</v:shape>");this.parent.appendChild(this.fragment);if(C&&this.fillStyle.img){this.element.getLast().fill.alignshape=false}this.path=[]},clip:function(){},isPointInPath:function(A,B){},processColor:function(B){var A=this.globalAlpha;if(B.substr(0,3)=="rgb"){if(B.charAt(3)=="a"){A*=B.match(/([\d.]*)\)$/)[1]}B=B.rgbToHex()}return{color:B,opacity:A}},processColorObject:function(E){var C="",B;if(E.addColorStop){C+=((E.r0)?('type="gradientradial" focusposition="0.2, 0.2" focussize="0.2, 0.2" '):('type="gradient" focus="0" angle="'+(180+(180*E.angle(E.x0,E.y0,E.x1,E.y1)/Math.PI))+'" '))+'color="'+E.col0.color+'" opacity="'+E.col0.opacity*100+'%" color2="'+E.col1.color+'" o:opacity2="'+E.col1.opacity*100+'%" colors="';if(E.stops){for(var D=0,A=E.stops.length;D<A;D++){C+=Math.round(100*E.stops[D][0])+"% "+E.stops[D][1]}}C+='" '}else{if(E.img){C+='type="tile" src="'+E.img.src+'" '}else{B=this.processColor(E);C+='color="'+B.color+'" opacity="'+B.opacity+'" '}}return C},getCoords:function(B,C){var A=this.m;return{x:this.Z*(B*A[0][0]+C*A[1][0]+A[2][0])-this.Z2,y:this.Z*(B*A[0][1]+C*A[1][1]+A[2][1])-this.Z2}},coord:function(B,C){var A=this.m;return[Math.round(this.Z*(B*A[0][0]+C*A[1][0]+A[2][0])-this.Z2),",",Math.round(this.Z*(B*A[0][1]+C*A[1][1]+A[2][1])-this.Z2)].join("")}});CanvasRenderingContext2D.implement({clearRect:function(A,D,B,C){this.element.innerHTML=""},fillRect:function(A,D,B,C){this.rect(A,D,B,C);this.fill()},strokeRect:function(A,D,B,C){this.rect(A,D,B,C);this.stroke()}});CanvasRenderingContext2D.implement({scale:function(A,B){this.arcScaleX*=A;this.arcScaleY*=B;this.matMult([[A,0,0],[0,B,0],[0,0,1]])},rotate:function(A){this.rot+=A;var C=Math.cos(A),B=Math.sin(A);this.matMult([[C,B,0],[-B,C,0],[0,0,1]])},translate:function(A,B){this.matMult([[1,0,0],[0,1,0],[A,B,1]])},transform:function(D,C,F,E,B,A){this.matMult([[D,F,B],[C,E,A],[0,0,1]])},setTransform:function(D,C,F,E,B,A){this.m=[[1,0,0],[0,1,0],[0,0,1]];this.transform(D,C,F,E,B,A)},matMult:function(B){var A=this.m,D=[[0,0,0],[0,0,0],[0,0,0]];for(var C=0;C<3;C++){if(B[0][C]!==0){this.sum(D[0],this.mult(B[0][C],A[C]))}if(B[1][C]!==0){this.sum(D[1],this.mult(B[1][C],A[C]))}if(B[2][C]!==0){this.sum(D[2],this.mult(B[2][C],A[C]))}}this.m=[D[0],D[1],D[2]]},mult:function(A,B){return[A*B[0],A*B[1],A*B[2]]},sum:function(B,A){B[0]+=A[0];B[1]+=A[1];B[2]+=A[2]}});CanvasRenderingContext2D.implement({drawImage:function(L,D){var A=arguments,B=A.length,T=(B==9)?4:0;if(!((B+"").test(/3|5|9/))){throw"Wrong number of arguments"}var H=L.runtimeStyle.width,C=L.runtimeStyle.height;L.runtimeStyle.width="auto";L.runtimeStyle.height="auto";var F=L.width,O=L.height;L.runtimeStyle.width=H;L.runtimeStyle.height=C;var K=0,J=0,M=F,S=O,G=A[1+T],E=A[2+T],I=A[3+T]||F,Q=A[4+T]||O;if(B==9){K=A[1];J=A[2];M=A[3];S=A[4]}var R=this.getCoords(G,E),P='<v:group coordsize="'+this.Z*10+","+this.Z*10+'" coordorigin="0,0" style="width:10;height:10;position:absolute;';if(this.m[0][0]!=1||this.m[0][1]){var N=Math.max(this.getCoords(G+I,E),this.getCoords(G,E+Q),this.getCoords(G+I,E+Q));P+="padding:0;padding-right:"+Math.round(Math.max(R.x,N)/this.Z)+"px;padding-bottom:"+Math.round(Math.max(R.y,N)/this.Z)+"px;filter:progid:DXImageTransform.Microsoft.Matrix(M11='"+this.m[0][0]+"', M12='"+this.m[1][0]+"', M21='"+this.m[0][1]+"', M22='"+this.m[1][1]+"', Dx='"+Math.round(R.x/this.Z)+"', Dy='"+Math.round(R.y/this.Z)+"', sizingmethod='clip');"}else{P+="top:"+Math.round(R.y/this.Z)+"px;left:"+Math.round(R.x/this.Z)+"px;"}this.element.insertAdjacentHTML("BeforeEnd",P+'"><v:image src="'+L.src+'" style="width:'+this.Z*I+";height:"+this.Z*Q+';" cropleft="'+K/F+'" croptop="'+J/O+'" cropright="'+(F-K-M)/F+'" cropbottom="'+(O-J-S)/O+'" /></v:group>');this.parent.appendChild(this.fragment)},drawImageFromRect:Function.empty,getImageData:function(D,C,A,B){},putImageData:function(C,B,A){},getCoords:function(B,C){var A=this.m;return{x:this.Z*(B*A[0][0]+C*A[1][0]+A[2][0])-this.Z2,y:this.Z*(B*A[0][1]+C*A[1][1]+A[2][1])-this.Z2}}});